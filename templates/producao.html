{% extends "base.html" %}
{% block title %}Produção{% endblock %}
{% block content %}
<div class="page-header"><div class="page-title">Produção</div></div>
<form method="post" class="block form">
  {% csrf_token %}
  <div class="field"><label for="{{ form.product.id_for_label }}">Produto</label>{{ form.product }}</div>
  <div class="field"><label for="{{ form.quantity.id_for_label }}">Quantidade</label>{{ form.quantity }}</div>
  <div class="form-actions">
    <button class="btn btn-primary" type="submit">Adicionar</button>
  </div>
</form>
<div class="page-title" style="font-size:20px;margin-top:18px">Produções em andamento</div>
<div class="block">
  <table>
    <thead><tr><th>Produto</th><th class="right">Quantidade</th><th class="right">Tempo total</th></tr></thead>
    <tbody>
    {% if orders %}
      {% for o in orders %}
      <tr>
        <td colspan="3">
          <details>
            <summary style="display:flex;justify-content:space-between;">
              <span>{{ o.obj.product.code }} — {{ o.obj.product.name }}</span>
              <span class="right" style="min-width:80px;text-align:right;">{{ o.obj.quantity }}</span>
              <span class="right" style="min-width:80px;text-align:right;">{{ o.total_time }}</span>
            </summary>
            <table style="width:100%;margin-top:8px;">
              <thead>
                <tr><th>Componente</th><th class="right">Qtd total</th><th class="right">Tempo total</th><th class="right">Custo total</th></tr>
              </thead>
              <tbody>
                {% for c in o.components %}
                <tr>
                  <td>{{ c.component.code }} — {{ c.component.name }}</td>
                  <td class="right">{{ c.required_qty }}</td>
                  <td class="right">{{ c.time_total }}</td>
                  <td class="right">R$ {{ c.cost_total|floatformat:2 }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </details>
        </td>
      </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="3" class="muted">Nenhuma produção em andamento.</td></tr>
    {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}

